# 箭头图标使用说明

## 📐 **问题修复**

### **1. 为什么之前每次60度？**
- **原因**：`cv2.arrowedLine()` 在低分辨率地图上渲染质量差
- **修复**：使用三角形 + 圆圈的组合，清晰度更高

### **2. 新的三角形箭头**
- ✅ 使用 `cv2.fillPoly()` 绘制实心三角形
- ✅ 三角形指向智能体朝向
- ✅ 中心圆圈标记智能体位置
- ✅ 黑色边框增强对比度

---

## 🎨 **使用自定义图标（可选）**

### **方法 1: 修改代码启用图标**

在 `minimal_mapping_test.py` 的 `__init__` 方法中：

```python
def __init__(self, config: Config, episode_index: int = None):
    # ...
    
    # 启用自定义图标
    self.agent_icon_path = "assets/agent_arrow.png"  # 图标路径
    self.use_icon = True  # 启用图标模式
```

### **方法 2: 创建箭头图标**

#### **推荐规格：**
- **格式**: PNG（支持透明背景）
- **尺寸**: 64×64 或 128×128 像素
- **方向**: 箭头向上（↑），代码会自动旋转
- **背景**: 透明（alpha通道）

#### **创建示例（Python）：**

```python
import numpy as np
import cv2

# 创建 64×64 透明图像
icon = np.zeros((64, 64, 4), dtype=np.uint8)

# 绘制箭头三角形（红色，不透明）
triangle = np.array([
    [32, 10],   # 顶点（向上）
    [15, 50],   # 左下
    [49, 50]    # 右下
], dtype=np.int32)

cv2.fillPoly(icon, [triangle], (255, 0, 0, 255))  # 红色RGBA
cv2.polylines(icon, [triangle], True, (0, 0, 0, 255), 2)  # 黑边

# 绘制圆形底座
cv2.circle(icon, (32, 32), 8, (255, 0, 0, 255), -1)
cv2.circle(icon, (32, 32), 8, (0, 0, 0, 255), 2)

# 保存
cv2.imwrite('assets/agent_arrow.png', icon)
```

#### **使用在线工具：**
1. **Figma / Illustrator**: 绘制箭头，导出为PNG
2. **GIMP**: 创建透明背景，手绘箭头
3. **IconFinder**: 下载现成的箭头图标

---

## 🚀 **使用效果对比**

### **三角形箭头（默认）**
```python
self.use_icon = False  # 默认
```
- ✅ 清晰锐利
- ✅ 无额外文件依赖
- ✅ 颜色可自定义
- ⚠️ 样式较简单

### **图标贴图（可选）**
```python
self.use_icon = True
self.agent_icon_path = "assets/agent_arrow.png"
```
- ✅ 可以使用精美图标
- ✅ 支持复杂设计
- ✅ 自动旋转对齐
- ⚠️ 需要准备图标文件

---

## 🔧 **自定义箭头颜色/大小**

在 `_create_colored_map()` 方法中修改：

```python
# 修改颜色（RGB格式）
colored_map = self._draw_arrow(colored_map, (pose_x, pose_y), angle, 
                               length=25,           # 箭头大小
                               color=(255, 0, 0),   # 红色
                               thickness=2)         # 线条粗细

# 其他颜色示例：
# (0, 255, 0)     # 绿色
# (0, 0, 255)     # 蓝色
# (255, 255, 0)   # 黄色
# (255, 0, 255)   # 紫色
```

---

## 📊 **角度验证**

新的实现正确处理了角度转换：
- **Habitat 坐标系**: 弧度制，0度=东，逆时针递增
- **地图坐标系**: y轴向下，需要翻转
- **三角形绘制**: 自动转换，每次旋转30°准确

测试输出：
```
Step 1:  30° (π/6)
Step 2:  60° (π/3)
Step 3:  90° (π/2)
...
Step 12: 360° (2π)
```
